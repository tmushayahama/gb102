angular.module("ui.tab.scroll",[]).provider("scrollableTabsetConfig",function(){var defaultConfig={showDropDown:!0,showTooltips:!0,tooltipLeftPlacement:"right",tooltipRightPlacement:"left",scrollBy:"50",autoRecalculate:!1},config=angular.extend({},defaultConfig);return{setShowDropDown:function(value){config.showDropDown=1==value},setShowTooltips:function(value){config.showTooltips=1==value},setTooltipLeftPlacement:function(value){config.tooltipLeftPlacement=value},setTooltipRightPlacement:function(value){config.tooltipRightPlacement=value},setScrollBy:function(value){config.scrollBy=value},setAutoRecalculate:function(value){config.autoRecalculate=1==value},$get:function(){return{showDropDown:config.showDropDown,showTooltips:config.showTooltips,tooltipLeftPlacement:config.tooltipLeftPlacement,tooltipRightPlacement:config.tooltipRightPlacement,scrollBy:config.scrollBy,autoRecalculate:config.autoRecalculate}}}}).directive("scrollableTabset",["scrollableTabsetConfig","$window","$interval","$timeout","$sce",function(scrollableTabsetConfig,$window,$interval,$timeout,$sce){return{restrict:"AE",transclude:!0,scope:{showDropDown:"@",showTooltips:"@",tooltipLeftPlacement:"@",tooltipRightPlacement:"@",scrollBy:"@",autoRecalculate:"@",isButtonsVisible:"=?",api:"=?"},template:['<div class="ui-tabs-scrollable" ng-class="{\'show-drop-down\': !hideDropDown}">','<button type="button" ng-mousedown="scrollButtonDown(\'left\', $event)" ng-mouseup="scrollButtonUp()" ng-hide="hideButtons" ng-disabled="disableLeft" class="btn nav-button left-nav-button" tooltip-placement="{{tooltipLeftDirection}}" uib-tooltip-html="tooltipLeftHtml"></button>','<div class="spacer" ng-class="{\'hidden-buttons\': hideButtons}" ng-transclude></div>','<button type="button" ng-mousedown="scrollButtonDown(\'right\', $event)" ng-mouseup="scrollButtonUp()" ng-hide="hideButtons" ng-disabled="disableRight" class="btn nav-button right-nav-button" tooltip-placement="{{tooltipRightDirection}}" uib-tooltip-html="tooltipRightHtml"></button>','<div class="btn-group" uib-dropdown dropdown-append-to-body ng-hide="hideDropDown">','<button type="button" class="btn" uib-dropdown-toggle></button>','<ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu role="menu">','<li role="menuitem" ng-repeat="tab in dropdownTabs" ng-class="{\'disabled\': tab.disabled}" ng-click="activateTab(tab)">',"<a href><span class=\"dropDownTabActiveMark\" ng-style=\"{'visibility': tab.active?'visible':'hidden'}\"></span>{{tab.tabScrollTitle}}</a>","</li>","</ul>","</div>","</div>"].join(""),link:function($scope,$el){$scope.dropdownTabs=[],$scope.hideButtons=!0,$scope.hideDropDown=!0,$scope.tooltipRightHtml="",$scope.tooltipLeftHtml="",$scope.disableLeft=!0,$scope.disableRight=!0,$scope.tooltipLeftDirection=$scope.tooltipLeftPlacement?$scope.tooltipLeftPlacement:scrollableTabsetConfig.tooltipLeftPlacement,$scope.tooltipRightDirection=$scope.tooltipRightPlacement?$scope.tooltipRightPlacement:scrollableTabsetConfig.tooltipRightPlacement,$scope.mouseDownInterval=null,$scope.isHolding=!1,$scope.winResizeTimeout,$scope.userShowDropDown=$scope.showDropDown?"true"===$scope.showDropDown:scrollableTabsetConfig.showDropDown,$scope.userShowTooltips=$scope.showTooltips?"true"===$scope.showTooltips:1==scrollableTabsetConfig.showTooltips,$scope.scrollByPixels=parseInt($scope.scrollBy?$scope.scrollBy:scrollableTabsetConfig.scrollBy),$scope.api={doRecalculate:function(){$timeout(function(){$scope.reCalcAll()})},scrollTabIntoView:function(arg){$timeout(function(){$scope.scrollTabIntoView(arg)})}},$scope.scrollTo=function(element,change,duration,callback,isLinear){var start=element.scrollLeft,increment=20,position=0,animateScroll=function(elapsedTime){elapsedTime+=increment,position=isLinear===!0?$scope.linearTween(elapsedTime,start,change,duration):$scope.easeInOutQuad(elapsedTime,start,change,duration),element.scrollLeft=position,duration>elapsedTime?setTimeout(function(){animateScroll(elapsedTime)},increment):callback()};animateScroll(0)},$scope.linearTween=function(currentTime,start,change,duration){return change*currentTime/duration+start},$scope.easeInOutQuad=function(currentTime,start,change,duration){return currentTime/=duration/2,1>currentTime?change/2*currentTime*currentTime+start:(currentTime--,-change/2*(currentTime*(currentTime-2)-1)+start)},$scope.onWindowResize=function(){clearTimeout($scope.winResizeTimeout),$scope.winResizeTimeout=setTimeout(function(){$scope.reCalcAll(),$scope.scrollTabIntoView(),$scope.$apply()},250)},$scope.cancelMouseDownInterval=function(){$scope.isHolding=!1,$scope.mouseDownInterval&&($interval.cancel($scope.mouseDownInterval),$scope.mouseDownInterval=null)},$scope.scrollButtonDown=function(direction,event){event.stopPropagation(),$scope.isHolding=!0;var realScroll="left"===direction?0-$scope.scrollByPixels:$scope.scrollByPixels;$scope.scrollTo($scope.tabContainer,realScroll,150,function(){$timeout(function(){$scope.reCalcSides()})},!0),$scope.mouseDownInterval=$interval(function(){$scope.isHolding&&($scope.scrollTo($scope.tabContainer,realScroll,150,function(){$timeout(function(){$scope.reCalcSides()})},!0),event.target.disabled&&$scope.cancelMouseDownInterval())},100)},$scope.scrollButtonUp=function(){$scope.cancelMouseDownInterval()},$scope.activateTab=function(tab){tab.disabled||(tab.select(),$timeout(function(){$scope.scrollTabIntoView()}))},$scope.reCalcSides=function(){$scope.tabContainer&&!$scope.hideButtons&&($scope.disableRight=$scope.tabContainer.scrollLeft>=$scope.tabContainer.scrollWidth-$scope.tabContainer.offsetWidth,$scope.disableLeft=$scope.tabContainer.scrollLeft<=0,$scope.userShowTooltips&&$scope.reCalcTooltips())},$scope.reCalcTooltips=function(){if($scope.tabContainer&&!$scope.hideButtons){var rightTooltips=[],leftTooltips=[],allTabs=$scope.tabContainer.querySelectorAll("ul.nav-tabs > li");angular.forEach(allTabs,function(tab){var rightPosition=parseInt(tab.getBoundingClientRect().left+tab.getBoundingClientRect().width-$scope.tabContainer.getBoundingClientRect().left),leftPosition=tab.getBoundingClientRect().left-$scope.tabContainer.getBoundingClientRect().left,heading=tab.getAttribute("data-tabScrollHeading"),ignore=tab.getAttribute("data-tabScrollIgnore");rightPosition>$scope.tabContainer.offsetWidth&&!ignore&&(heading?rightTooltips.push(heading):tab.textContent&&rightTooltips.push(tab.textContent)),0>leftPosition&&!ignore&&(heading?leftTooltips.push(heading):tab.textContent&&leftTooltips.push(tab.textContent))});var rightTooltipsHtml=rightTooltips.join("<br>");$scope.tooltipRightHtml=$sce.trustAsHtml(rightTooltipsHtml);var leftTooltipsHtml=leftTooltips.join("<br>");$scope.tooltipLeftHtml=$sce.trustAsHtml(leftTooltipsHtml)}},$scope.scrollTabIntoView=function(arg){if($scope.tabContainer&&!$scope.hideButtons){var tabToScroll,argInt=parseInt(arg);if(argInt){var allTabs=$scope.tabContainer.querySelectorAll("ul.nav-tabs > li");allTabs.length>argInt&&(tabToScroll=allTabs[argInt])}else{var activeTab=$scope.tabContainer.querySelector("li.active");activeTab&&(tabToScroll=activeTab)}if(tabToScroll){var rightPosition=parseInt(tabToScroll.getBoundingClientRect().left+tabToScroll.getBoundingClientRect().width-$scope.tabContainer.getBoundingClientRect().left),leftPosition=tabToScroll.getBoundingClientRect().left-$scope.tabContainer.getBoundingClientRect().left;if(0>leftPosition){var dif=leftPosition-20;$scope.scrollTo($scope.tabContainer,dif,700,function(){$timeout(function(){$scope.reCalcSides()})})}else if(rightPosition>$scope.tabContainer.offsetWidth){var dif=rightPosition-$scope.tabContainer.offsetWidth+20;$scope.scrollTo($scope.tabContainer,dif,700,function(){$timeout(function(){$scope.reCalcSides()})})}}}},$scope.init=function(){if($scope.tabContainer=$el[0].querySelector(".spacer ul.nav-tabs"),$scope.tabContainer){var autoRecalc=$scope.autoRecalculate?"true"===$scope.autoRecalculate:scrollableTabsetConfig.autoRecalculate;if(autoRecalc){var tabsetElement=angular.element($el[0].querySelector(".spacer div"));$scope.$watchCollection(function(){return tabsetElement.isolateScope()?tabsetElement.isolateScope().tabs:!1},function(){$timeout(function(){$scope.reCalcAll()})})}$scope.reCalcAll(),angular.element($window).on("resize",$scope.onWindowResize)}},$scope.reCalcAll=function(){if($scope.tabContainer&&($scope.hideButtons=$scope.tabContainer.scrollWidth<=$scope.tabContainer.offsetWidth,$scope.hideDropDown=$scope.userShowDropDown?$scope.hideButtons:!0,$scope.isButtonsVisible=!$scope.hideButtons,!$scope.hideButtons)){if(!$scope.hideDropDown){var allTabs=$scope.tabContainer.querySelectorAll("ul.nav-tabs > li");$scope.dropdownTabs=[],angular.forEach(allTabs,function(tab){var ignore=tab.getAttribute("data-tabScrollIgnore");if(!ignore){var heading=tab.getAttribute("data-tabScrollHeading"),tabScope=angular.element(tab).isolateScope();tabScope.tabScrollTitle=heading?heading:tab.textContent.trim(),$scope.dropdownTabs.push(tabScope)}})}$scope.reCalcSides()}},$timeout(function(){$scope.init()}),$scope.$on("$destroy",function(){angular.element($window).off("resize",$scope.onWindowResize)})}}}]);