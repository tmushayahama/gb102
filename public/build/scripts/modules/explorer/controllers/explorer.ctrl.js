var explorerCtrl=function(_,level_categories,ConstantsSrv,ExplorerSectionsSrv,ComponentsSrv,ContributionsSrv,$scope,$state,$stateParams,$http,$rootScope,$location,$uibModal,$log,$filter,$css){var vm=this;vm.componentsSrv=new ComponentsSrv,vm.constantsSrv=new ConstantsSrv,vm.appsConstants=[],vm.componentId=$stateParams.componentId,vm.component=[],vm.componentsCopy,vm.componentFormDisplay=!1,vm.defaultComponentData={explorerId:vm.explorerId,typeId:level_categories.component.none,title:"",description:"",privacy:0},vm.explorerFormDisplay=!1,vm.newColumnData={title:""},vm.explorerSections=[],vm.explorerSectionsCopy,vm.explorerSectionsSrv=new ExplorerSectionsSrv,vm.sectionFormDisplay=!1,vm.defaultExplorerSectionData={explorerId:$stateParams.explorerId,privacy:0},vm.newExplorerSectionData=angular.copy(vm.defaultExplorerSectionData),vm.explorerContributions,vm.explorerContributionTypes,vm.explorerContributionsCopy,vm.constantsSrv=new ConstantsSrv,vm.contributionsSrv=new ContributionsSrv,vm.contributionFormDisplay=!1,vm.defaultContributionData={explorerId:$stateParams.explorerId,privacy:0},vm.newContributionData=angular.copy(vm.defaultContributionData),vm.showContributionForm=function(){vm.contributionFormDisplay=!0},vm.editDescriptionMode={visible:!1,show:function(){vm.editDescriptionMode.visible=!0,vm.editDescriptionMode.data={componentId:vm.component.id,title:vm.component.title,description:vm.component.description}},hide:function(){vm.editDescriptionMode.visible=!1},edit:function(){vm.componentsSrv.editComponentDescription(vm.editDescriptionMode.data).then(function(response){vm.component.title=response.title,vm.component.description=response.description,vm.editDescriptionMode.hide()},function(response){console.log(response)})}},vm.getDefaultComponentData=function(parentComponentId){var result=angular.copy(vm.defaultComponentData);return parentComponentId&&(result.parentComponentId=parentComponentId),result},vm.getExplorer=function(id){vm.componentsSrv.getExplorer(id).then(function(response){})},vm.defaultExplorerData={explorerId:$stateParams.explorerId,privacy:0},vm.newExplorerData=angular.copy(vm.defaultExplorerData),vm.createExplorer=function(data){vm.componentsSrv.createExplorer(data).then(function(response){vm.FormDisplay=!1,vm.newExplorerData=angular.copy(vm.defaultExplorerData),vm.explorerCopy=angular.copy(vm.componentsSrv.explorer)},function(response){console.log(response)})},vm.editExplorerSections={details:function(explorerId,detail){var explorerData={explorerId:explorerId,title:detail.title,description:detail.description};vm.editExplorer(explorerData)}},vm.cancelExplorer=function(form){vm.FormDisplay=!1,vm.newExplorerData=angular.copy(vm.defaultExplorerData),form&&(form.$setPristine(),form.$setUntouched())},vm.getExplorerSections=function(explorerId){vm.explorerSectionsSrv.getExplorerSections(explorerId).then(function(response){vm.explorerSections=response,angular.forEach(response,function(question,key){vm.explorerSectionsSrv.getSectionAnswersPreview(question.id,explorerId).then(function(answerResponse){vm.explorerSections[key].answers=answerResponse,vm.explorerSections[key].explorer_id=explorerId;var minSizeY=1+Math.floor(answerResponse.length/5);vm.explorerSections[key].gridMap={minSizeY:minSizeY,maxSizeY:4}})})})},vm.createExplorerSection=function(data){vm.explorerSectionsSrv.createExplorerSection(data).then(function(response){vm.sectionFormDisplay=!1,vm.newExplorerSectionData=angular.copy(vm.defaultExplorerSectionData),vm.explorerSections.unshift(response)},function(response){console.log(response)})},vm.editExplorerSection=function(data){vm.explorerSectionsSrv.editExplorerSection(data).then(function(response){vm.sectionFormDisplay=!1,vm.newExplorerSectionData=angular.copy(vm.defaultExplorerSectionData),vm.explorerSectionsCopy=angular.copy(vm.explorerSections)},function(response){console.log(response)})},vm.editExplorerSectionSections={details:function(explorerSectionId,detail){var explorerSectionData={explorerSectionId:explorerSectionId,title:detail.title,description:detail.description};vm.editExplorerSection(explorerSectionData)}},vm.cancelExplorerSection=function(form){vm.sectionFormDisplay=!1,vm.newExplorerSectionData=angular.copy(vm.defaultExplorerSectionData),form&&(form.$setPristine(),form.$setUntouched())},vm.openExplorerSection=function(explorerSection){var modalInstance=$uibModal.open({animation:!0,templateUrl:"explorer-section-modal.html",controller:"ExplorerSectionCtrl as explorerSectionCtrl",backdrop:"static",size:"xl",resolve:{explorerSectionData:function(){return explorerSection}}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})},vm.openExplorerSectionItem=function(explorerSectionItem){var modalInstance=$uibModal.open({animation:!0,templateUrl:"explorer-section-item-modal.html",controller:"ExplorerSectionItemCtrl as explorerSectionItemCtrl",backdrop:"static",size:"xl",resolve:{explorerSectionData:function(){return explorerSectionItem}}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})},vm.addToExplorerSection=function(data){return console.log("added",data),vm.explorerSectionsSrv.createAnswer(data)},vm.getExplorerSections(vm.explorerId),vm.getSubExplorersStats=function(explorerId){vm.componentsSrv.getSubExplorersStats(explorerId).then(function(data){vm.subExplorersStats=data})},vm.getComponents=function(explorerId,componentId){vm.componentsSrv.getComponents(explorerId,componentId,1).then(function(response){vm.componentBuckets=response,vm.componentBuckets.newComponentData=vm.getDefaultComponentData()})},vm.createComponent=function(componentBucket){vm.componentsSrv.createComponent(componentBucket.newComponentData).then(function(response){componentBucket.newComponentData.parentComponentId?(componentBucket.components.push(response),componentBucket.newComponentData=vm.getDefaultComponentData(componentBucket.newComponentData.parentComponentId)):(componentBucket.components.push(response),componentBucket.newComponentData=vm.getDefaultComponentData())},function(response){console.log(response)})},vm.editComponent=function(data){vm.componentsSrv.editComponent(data).then(function(response){vm.componentFormDisplay=!1,vm.newComponentData=angular.copy(vm.defaultComponentData),vm.componentsCopy=angular.copy(vm.components)},function(response){console.log(response)})},vm.editComponentSections={details:function(componentId,detail){var componentData={componentId:componentId,title:detail.title,description:detail.description};vm.editComponent(componentData)}},vm.openComponent=function(componentId){var modalInstance=$uibModal.open({animation:!0,templateUrl:"component-modal.html",controller:"ComponentCtrl as componentCtrl",backdrop:"static",size:"explorer-view",resolve:{componentId:function(){return componentId},appsConstants:function(){return vm.appsConstants}}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})},vm.createContribution=function(data){vm.contributionsSrv.createContribution(data).then(function(response){vm.contributionFormDisplay=!1,vm.newContributionData=angular.copy(vm.defaultContributionData),vm.explorerContributionsCopy=angular.copy(vm.contributionsSrv.explorerContributions)},function(response){console.log(response)})},vm.editContribution=function(data){vm.contributionsSrv.editContribution(data).then(function(response){vm.contributionFormDisplay=!1,vm.newContributionData=angular.copy(vm.defaultContributionData),vm.explorerContributionsCopy=angular.copy(vm.contributionsSrv.explorerContributions)},function(response){console.log(response)})},vm.editContributionSections={details:function(explorerContributionId,detail){var explorerContributionData={explorerContributionId:explorerContributionId,title:detail.title,description:detail.description};vm.editContribution(explorerContributionData)}},vm.prepareSelectUsers=function(contributionType){var modalInstance=$uibModal.open({animation:!0,templateUrl:"create-contribution-modal.html",controller:"CreateContributionCtrl as createContributionCtrl",backdrop:"static",size:"xl",resolve:{contributionType:function(){return contributionType}}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})},vm.openContribution=function(explorerContribution){var modalInstance=$uibModal.open({animation:!0,templateUrl:"contribution-modal.html",controller:"ContributionCtrl as explorerContributionCtrl",backdrop:"static",size:"xl",resolve:{explorerContributionData:function(){return explorerContribution}}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})},vm.constantsSrv.getConstants().then(function(data){vm.appsConstants=data}),vm.contributionsSrv.getContributions(vm.explorerId).then(function(data){vm.explorerContributions=data}),vm.getComponent=function(componentId,listFormat){vm.componentsSrv.getComponent(componentId,listFormat).then(function(response){vm.component=response,$css.bind({href:"public/build/css/gb-sass/stylesheets/gb-themes/app-theme-"+response.type.title+".css"},$scope)})},vm.getComponent(vm.componentId,3)};explorerCtrl.$inject=["_","level_categories","ConstantsSrv","ExplorerSectionsSrv","ComponentsSrv","ContributionsSrv","$scope","$state","$stateParams","$http","$rootScope","$location","$uibModal","$log","$filter","$css"],angular.module("app.explorer").controller("ExplorerCtrl",explorerCtrl);