var addComponentCtrl=function(constantsSrv,communitySrv,level_categories,$uibModalInstance,$q,$timeout,$scope,$state,$stateParams,$http,$rootScope,$location,$log,selectedType){function querySearch(criteria){return cachedQuery=cachedQuery||criteria,cachedQuery?vm.allContacts.filter(createFilterFor(cachedQuery)):[]}function delayedQuerySearch(criteria){return cachedQuery=criteria,pendingSearch&&debounceSearch()?pendingSearch:(cancelSearch(),pendingSearch=$q(function(resolve,reject){cancelSearch=reject,$timeout(function(){resolve(vm.querySearch()),refreshDebounce()},500*Math.random(),!0)}))}function refreshDebounce(){lastSearch=0,pendingSearch=null,cancelSearch=angular.noop}function debounceSearch(){var now=(new Date).getMilliseconds();return lastSearch=lastSearch||now,300>now-lastSearch}function createFilterFor(query){var lowercaseQuery=angular.lowercase(query);return function(contact){var lowerCaserFilterString=angular.lowercase(contact.firstname);return-1!=lowerCaserFilterString.indexOf(lowercaseQuery)}}var vm=this;vm.component={},vm.componentLevels,vm.requestTypes,vm.requestTypes=[],vm.selectedAppType,vm.component.description="",vm.constantsSrv=constantsSrv,vm.communitySrv=communitySrv,vm.getLevels=function(appId){vm.constantsSrv.getSubLevels(appId).then(function(data){vm.componentLevels=data})},vm.getUsers=function(){vm.constantsSrv.getSubLevels().then(function(data){vm.componentLevels=data})},vm.getRequestTypes=function(appId){vm.constantsSrv.getSubLevels(appId+level_categories.request_type_offset).then(function(data){vm.requestTypes=[],angular.forEach(data,function(requestLevel){vm.requestTypes.push({requestLevel:requestLevel,checked:!1,componentRequest:{levelId:requestLevel.id,description:""}})})})},vm.getPrivacyTypes=function(){vm.constantsSrv.getSubLevels(level_categories.privacy_type).then(function(data){vm.privacyTypes=data,vm.component.privacy_id=level_categories.privacy["private"]})},vm.chooseAppType=function(type){vm.component.typeId=type.id,vm.selectedAppType=type,vm.getLevels(type.id),vm.getRequestTypes(type.id)},vm.ok=function(){vm.component.component_requests=[],vm.component.component_share_with_ids=[],vm.component.component_picture_url="default.png",angular.forEach(vm.selectedRequestTypes,function(selectedRequestType){vm.component.component_requests.push(selectedRequestType.componentRequest)}),angular.forEach(vm.shareWithUsers,function(shareWithUser){vm.component.component_share_with_ids.push(shareWithUser.id)}),$uibModalInstance.close(vm.component)},vm.close=function(){$uibModalInstance.dismiss("cancel")};var pendingSearch,cachedQuery,lastSearch,cancelSearch=angular.noop;vm.shareWithUsers=[],vm.filterSelected=!0,vm.querySearch=querySearch,vm.delayedQuerySearch=delayedQuerySearch,selectedType?vm.chooseAppType(selectedType):vm.chooseAppType($rootScope.apps[0]),vm.getPrivacyTypes(),vm.communitySrv.getUsers().then(function(){return vm.allContacts=vm.communitySrv.users,vm.contacts=[vm.allContacts[0]],vm.contacts.map(function(c,index){var contact={name:c.firstname+" "+c.lastname,email:c.email,image:c.avatar_url};return contact._lowername=contact.name.toLowerCase(),contact})})};addComponentCtrl.$inject=["constantsSrv","communitySrv","level_categories","$uibModalInstance","$q","$timeout","$scope","$state","$stateParams","$http","$rootScope","$location","$log","selectedType"],angular.module("app.explorer").controller("AddComponentCtrl",addComponentCtrl);